<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Running Workouts</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <h1>Your Running Workouts</h1>
        <p>Here are your recent running workouts from Strava:</p>

        <!-- Workouts List -->
        <ul class="workouts-list">
            <% workouts.forEach(workout => { %>
                <li class="workout-item">
                    <input type="checkbox" class="workout-select" value="<%= workout.id %>">
                    <span><strong><%= workout.name %></strong></span>
                    <span>Distance: <%= (workout.distance / 1000).toFixed(2) %> km</span>
                    <span>Moving Time: <%= (workout.moving_time / 60).toFixed(2) %> mins</span>
                    <span>Date: <%= new Date(workout.start_date).toLocaleDateString() %></span>
                    <span>Shoes: <%= workout.gear.name %></span>
                </li>
            <% }) %>
        </ul>

        <!-- Load More Button -->
        <div class="styled-button">
            <form action="/workouts" method="GET">
                <!-- Pass the access token in the query parameter -->
                <input type="hidden" name="access_token" value="<%= accessToken %>">
                <input type="hidden" name="page" value="<%= page + 1 %>">
                <button type="submit" class="styled-button">Load More</button>
            </form>
            <button id="compare-button" class="styled-button">Compare Selected Workouts</button>
        </div>

        <% if (workouts.length === 0) { %>
            <p>No more running workouts found.</p>
        <% } %>
    </div>

    <script>
        // Function to update session storage with selected workouts
        function updateSelectedWorkouts() {
            const selectedWorkouts = Array.from(document.querySelectorAll('.workout-select:checked'))
                .map(checkbox => checkbox.value);

            sessionStorage.setItem('selectedWorkouts', JSON.stringify(selectedWorkouts));
        }

        // Add event listeners to checkboxes
        document.querySelectorAll('.workout-select').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedWorkouts);
        });

        document.getElementById('compare-button').addEventListener('click', function() {
            const selectedWorkouts = JSON.parse(sessionStorage.getItem('selectedWorkouts') || '[]');

            if (selectedWorkouts.length !== 2) {
                alert('Please select exactly two workouts to compare.');
                return;
            }

            // Redirect to the comparison page
            window.location.href = '/workouts/compare';
        });
    </script>
</body>
</html>
